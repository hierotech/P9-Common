!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("amqplib"),require("lodash.merge"),require("big.js"),require("decimal.js"),require("axios"),require("http-terminator")):"function"==typeof define&&define.amd?define(["amqplib","lodash.merge","big.js","decimal.js","axios","http-terminator"],t):"object"==typeof exports?exports.P9Common=t(require("amqplib"),require("lodash.merge"),require("big.js"),require("decimal.js"),require("axios"),require("http-terminator")):e.P9Common=t(e.amqplib,e["lodash.merge"],e["big.js"],e["decimal.js"],e.axios,e["http-terminator"])}(global,(function(e,t,n,r,i,a){return(()=>{var o={228:e=>{e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}},858:e=>{e.exports=function(e){if(Array.isArray(e))return e}},646:(e,t,n)=>{var r=n(228);e.exports=function(e){if(Array.isArray(e))return r(e)}},926:e=>{function t(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(c){return void n(c)}s.done?t(u):Promise.resolve(u).then(r,i)}e.exports=function(e){return function(){var n=this,r=arguments;return new Promise((function(i,a){var o=e.apply(n,r);function s(e){t(o,i,a,s,u,"next",e)}function u(e){t(o,i,a,s,u,"throw",e)}s(undefined)}))}}},575:e=>{e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},913:e=>{function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}},713:e=>{e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},860:e=>{e.exports=function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}},884:e=>{e.exports=function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,i=!1,a=undefined;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(u){i=!0,a=u}finally{try{r||null==s["return"]||s["return"]()}finally{if(i)throw a}}return n}}},521:e=>{e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},206:e=>{e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},38:(e,t,n)=>{var r=n(858),i=n(884),a=n(379),o=n(521);e.exports=function(e,t){return r(e)||i(e,t)||a(e,t)||o()}},319:(e,t,n)=>{var r=n(646),i=n(860),a=n(379),o=n(206);e.exports=function(e){return r(e)||i(e)||a(e)||o()}},379:(e,t,n)=>{var r=n(228);e.exports=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}},757:(e,t,n)=>{e.exports=n(666)},693:(e,t,n)=>{"use strict";n.r(t),n.d(t,{AmqpClient:()=>C,Assets:()=>i,BtcClient:()=>o,Constants:()=>r,Currency:()=>s,Funds:()=>u,Helper:()=>a,Storage:()=>l,TerminationHandler:()=>wt});var r={};n.r(r),n.d(r,{ASSET_COMPONENT_MODES:()=>q,CANDLESTICK_INTERVALS:()=>D,DATA_PROVIDERS:()=>R,DEAL_TYPES:()=>N,DEMAND_TYPES:()=>U,DEPOSIT_FEE_USD:()=>$,EXPECTED_SELL_FEE_COEFF:()=>W,FILE_TYPES:()=>L,IDENTITY_CARD_TYPES:()=>F,IMAGE_MIME_TYPES:()=>Y,RX_BTC_ADDRESS:()=>Z,RX_DATE:()=>ee,RX_DATE_ANY:()=>te,RX_EMAIL:()=>ne,RX_NUMERIC:()=>re,RX_NUMERIC_NON_NEGATIVE:()=>ie,RX_NUMERIC_POSITIVE:()=>ae,RX_UUID:()=>oe,SUCCESS_FEE_DISCOUNT_PROMO:()=>z,SUCCESS_FEE_DISCOUNT_PROMO_PERIOD:()=>X,TRANSACTION_TYPES:()=>j,UPLOAD_TYPES:()=>M,USER_DOCUMENT_MIME_TYPES:()=>B,USER_ID_SELF:()=>G,USER_LOCK_REASONS:()=>H,WITHDRAW_FEE_USD_BASE:()=>Q,WITHDRAW_FEE_USD_COEFF:()=>V,WITHDRAW_FEE_USD_MAX:()=>K,WITHDRAW_FEE_USD_MIN:()=>J});var i={};n.r(i),n.d(i,{getAverageBuyPrice:()=>le,getBuyAmountSum:()=>ce,getBuyPriceAmountSum:()=>ue,getClosedUsedBuyingPower:()=>he,getGrossProfit:()=>me,getGrossValue:()=>de,getNetProfit:()=>be,getOneMinusStrategyCoefficient:()=>ye,getOpenedUsedBuyingPower:()=>pe,getRealizedNetProfit:()=>xe,getRealizedSellFee:()=>ge,getRealizedSuccessFee:()=>ve,getSellFee:()=>we,getSuccessFee:()=>_e,getSuccessFeeDiscount:()=>se,getUsedBuyingPower:()=>fe});var a={};n.r(a),n.d(a,{TIMESTAMP_PRECISION:()=>Ce,createAddressString:()=>Pe,createFullName:()=>De,createTimestamp:()=>qe,delay:()=>Re,excludeFields:()=>je,exposeFields:()=>Fe,extractCount:()=>Ne,hasOwnProperty:()=>Ue,isAgreementAgentSignedOrRequestedStatus:()=>Me,isAgreementSignedOrRequestedStatus:()=>He,isAgreementSignedStatus:()=>Le,isVerifiedOrRequestedStatus:()=>Ye,isVerifiedStatus:()=>Ge,stringifyQuery:()=>Be,toChunks:()=>We});var o={};n.r(o),n.d(o,{createClient:()=>ze});var s={};n.r(s),n.d(s,{CRYPTO_UNIT_ATOM_COUNT:()=>Je,CURRENCY_SIGN:()=>Ke,CURRENCY_TYPES:()=>Ze,DECIMAL_DIGIT_COUNT:()=>Ve,cryptoAtomsToUnit:()=>nt,formatCurrency:()=>it,isCryptoCurrency:()=>ot,isFiatCurrency:()=>at,ratioPercent:()=>st,unitToCryptoAtoms:()=>rt});var u={};n.r(u),n.d(u,{getWithdrawFeeUsd:()=>ut});var c={};n.r(c),n.d(c,{createUserOperationAsset:()=>pt,createUserOperationWallet:()=>dt,init:()=>yt});var l={};n.r(l),n.d(l,{UserOperations:()=>c,init:()=>vt});var f=n(757),p=n.n(f),h=n(926),d=n.n(h),m=n(575),y=n.n(m),v=n(913),_=n.n(v),g=n(713),w=n.n(g),b=n(310),x=n.n(b),S=n(914),E=n.n(S),C=function(){function e(t){var n=this;y()(this,e),w()(this,"_handleMessage",(function(e){return function(){var t=d()(p().mark((function r(t){var i,a,o,s;return p().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,e.ack(t);case 3:if(t&&t.content){r.next=6;break}return console.warn("[AmqpClient._handleMessage]","Invalid message from queue",t),r.abrupt("return");case 6:if(i=JSON.parse(t.content.toString()),a=i.type,o=i.data,s=n._handlers.get(a)){r.next=11;break}return console.warn("[AmqpClient._handleMessage]",'No handler for type: "'.concat(a,'", data:'),o),r.abrupt("return");case 11:return r.next=13,s(o,a);case 13:r.next=18;break;case 15:r.prev=15,r.t0=r["catch"](0),console.warn(r.t0);case 18:case"end":return r.stop()}}),r,null,[[0,15]])})));return function(e){return t.apply(this,arguments)}}()})),w()(this,"_handleClose",(function(){n._connection=null,n._isClosing||n._isHandlingClose||(n._isHandlingClose=!0,n._consumeChannel=null,n._publishChannel=null,console.error("[AmqpClient._handleClose]","Connection failed or lost. Reconnecting in ".concat(n._config.reconnectionDelay," msecs...")),setTimeout(d()(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n._init();case 3:n._isHandlingClose=!1,e.next=11;break;case 6:e.prev=6,e.t0=e["catch"](0),console.error("[AmqpClient._handleClose::setTimeout]",e.t0),n._isHandlingClose=!1,n._handleClose();case 11:case"end":return e.stop()}}),e,null,[[0,6]])}))),n._config.reconnectionDelay))})),this._config=E()({},e.DEFAULT_CONFIG,t),this._temporaryQueue=[],this._consumeChannel=null,this._publishChannel=null,this._isHandlingClose=!1,this._handlers=new Map,this._isClosing=!1,this._connection=null}var t,n,r,i,a,o,s,u;return _()(e,null,[{key:"DEFAULT_CONFIG",get:function(){return{exchange:{consume:{type:"fanout"},publish:{type:"fanout"}},reconnectionDelay:1e4,sendToConsumeChannel:!1}}}]),_()(e,[{key:"init",value:(u=d()(p().mark((function c(){var e,t,n,r=arguments;return p().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return e=r.length>0&&r[0]!==undefined?r[0]:{},t=e.throwOnError,n=void 0!==t&&t,i.prev=1,i.next=4,this._init();case 4:i.next=12;break;case 6:if(i.prev=6,i.t0=i["catch"](1),!n){i.next=10;break}throw i.t0;case 10:console.error("[AmqpClient.init]",i.t0),this._handleClose();case 12:case"end":return i.stop()}}),c,this,[[1,6]])}))),function(){return u.apply(this,arguments)})},{key:"close",value:(s=d()(p().mark((function l(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._isClosing){e.next=2;break}return e.abrupt("return");case 2:if(this._connection){e.next=4;break}return e.abrupt("return");case 4:return this._isClosing=!0,e.prev=5,e.next=8,this._connection.close();case 8:return e.prev=8,this._isClosing=!1,e.finish(8);case 11:case"end":return e.stop()}}),l,this,[[5,,8,11]])}))),function(){return s.apply(this,arguments)})},{key:"installHandler",value:function(e,t){this._handlers.set(e,t)}},{key:"publish",value:(o=d()(p().mark((function f(e){var t,n,r,i=arguments;return p().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(t=i.length>1&&i[1]!==undefined&&i[1],this._config){a.next=3;break}throw new Error("[AmqpClient.publish] Client is not initialized");case 3:if(n=t?this._consumeChannel:this._publishChannel){a.next=7;break}return this._temporaryQueue.push({message:e,toConsumeChannel:t}),a.abrupt("return");case 7:return r=this._config.exchange[t?"consume":"publish"].name,a.next=10,n.publish(r,"",Buffer.from(JSON.stringify(e)));case 10:case"end":return a.stop()}}),f,this)}))),function(e){return o.apply(this,arguments)})},{key:"broadcast",value:(a=d()(p().mark((function h(e){return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.publish({data:{type:"broadcast",data:{data:e}},type:"notification"},this._config.sendToConsumeChannel);case 2:case"end":return t.stop()}}),h,this)}))),function(e){return a.apply(this,arguments)})},{key:"send",value:(i=d()(p().mark((function m(e,t){return p().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.publish({data:{type:"send",data:{receiverId:e,data:t}},type:"notification"},this._config.sendToConsumeChannel);case 2:case"end":return n.stop()}}),m,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"_initConsume",value:(r=d()(p().mark((function v(e){var t,n,r,i,a,o;return p().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,e.createChannel();case 2:return t=s.sent,s.next=5,t.assertQueue(null,{autoDelete:!0});case 5:return n=s.sent,r=n.queue,i=this._config.exchange.consume,a=i.name,o=i.type,s.next=10,t.assertExchange(a,o);case 10:return s.next=12,t.bindQueue(r,a);case 12:return s.next=14,t.consume(r,this._handleMessage(t));case 14:return s.abrupt("return",t);case 15:case"end":return s.stop()}}),v,this)}))),function(e){return r.apply(this,arguments)})},{key:"_initPublish",value:(n=d()(p().mark((function g(e){var t,n,r,i;return p().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,e.createChannel();case 2:return t=a.sent,n=this._config.exchange.publish,r=n.name,i=n.type,a.next=6,t.assertExchange(r,i);case 6:return a.abrupt("return",t);case 7:case"end":return a.stop()}}),g,this)}))),function(e){return n.apply(this,arguments)})},{key:"_init",value:(t=d()(p().mark((function b(){var e,t,n,r;return p().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,x().connect(this._config.connection.url);case 2:return e=i.sent,i.next=5,this._initConsume(e);case 5:return this._consumeChannel=i.sent,i.next=8,this._initPublish(e);case 8:this._publishChannel=i.sent,this._connection=e,e.on("close",this._handleClose),e.on("error",(function(e){return console.error("[AmqpClient._init::connection.on('error')]",e)})),this._temporaryQueue.length>0&&console.log("[AmqpClient._init]","Flushing temporary queue...");case 13:if(!(this._temporaryQueue.length>0)){i.next=19;break}return t=this._temporaryQueue.shift(),n=t.message,r=t.toConsumeChannel,i.next=17,this.publish(n,r);case 17:i.next=13;break;case 19:console.log("[AmqpClient._init]","Connection established");case 20:case"end":return i.stop()}}),b,this)}))),function(){return t.apply(this,arguments)})}]),e}(),T=n(319),I=n.n(T),O=n(297),A=n.n(O),k=n(815),P=n.n(k),D=["1m","5m","15m","1h","4h","1d"],q=["addition","subtraction"],R=["binance","bitmex","coinmarketcap","cryptocompare","deribit","iex"],N=["IPO","PRE_IPO","STARTUP","ETF"],U=["COLD","WARM","HOT"],j=["deposit","withdraw"],F=["passport"],M=["user_avatar","user_passport","user_residence_proof","user_passport_selfie","asset_logo","asset_placeholder"],L=[].concat(M,["user_agreement_signed","user_agreement_agent_signed","user_invoice_pdf"]),H=["password_change"],G="self",Y=["image/png","image/jpeg"],B=[].concat(Y,["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]),W=.005,z=.5,X=15552e6,$=10,Q=20,V=.0015,K=100,J=30,Z=/^\w{14,74}$/,ee=/^20(1[6-9]|[2-9][0-9])-(0[1-9]|1[0-2])-([0-2][0-9]|3[0-1])T[0-5][0-9]:[0-5][0-9]:[0-5][0-9].[0-9]{3}Z$/,te=/^[1-2][0-9]{3}-(0[1-9]|1[0-2])-([0-2][0-9]|3[0-1])T[0-5][0-9]:[0-5][0-9]:[0-5][0-9].[0-9]{3}Z$/,ne=/^[^@]+@[^@]+$/,re=/^[0-9]+(\.[0-9]+)?$/,ie=/^[0-9]+(\.[0-9]+)?$/,ae=/^([0-9]+\.0*[1-9][0-9]*|0*[1-9][0-9]*(\.[0-9]+)?)$/,oe=/^[0-9a-z]{8}-[0-9a-z]{4}-[0-9a-z]{4}-[0-9a-z]{4}-[0-9a-z]{12}$/i;function se(e){var t=e.success_fee_discount,n=Date.now()<new Date(e.created_at).getTime()+X,r=e.referrer_id&&n?z:null;return t&&r?Math.max(Number(t),r):t||r}function ue(e){return e.filter((function(e){return"buy"===e.type})).reduce((function(e,t){var n=t.quantity,r=t.price;return e.plus(new(A())(r).times(n))}),new(A())(0))}function ce(e){return e.filter((function(e){return"buy"===e.type})).reduce((function(e,t){var n=t.quantity;return e.plus(n)}),new(A())(0))}function le(e){var t=ue(e),n=ce(e);return n.eq(0)?new(A())(0):t.div(n)}function fe(e){var t=ue(e),n=ce(e);if(n.eq(0))return new(A())(0);var r=t.div(n),i=e.filter((function(e){return"sell"===e.type})).reduce((function(e,t){var n=t.quantity;return e.plus(r.times(n))}),new(A())(0));return t.minus(i)}function pe(e){return ue(e)}function he(e,t){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null,r=n&&new Date(n),i=r?e.filter((function(e){return new Date(e.timestamp)<r})):e,a=ue(i),o=ce(i);if(o.eq(0))return new(A())(0);var s=a.div(o);return s.times(t)}function de(e,t){var n=new(A())(e.price_last).times(e.quantity);if("ETF"===e.deal_type)return n;var r=t.filter((function(e){return"sell"===e.type})).reduce((function(e,t){var n=t.quantity,r=t.price;return e.plus(new(A())(r).times(n))}),new(A())(0));return n.plus(r)}function me(e,t){var n=de(e,t);return"ETF"===e.deal_type?n.minus(fe(t)):n.minus(ue(t))}function ye(e){var t=fe(e);if(t.eq(0))return new(A())(0);if(t.lte(1e4))return new(A())(.2);if(t.gte(12e5))return new(A())(.04);var n=new(P())(t.toString()).pow(.876);return new(A())(50.75).minus(P().log(n,1.3)).div(100)}function ve(e){return e.filter((function(e){return"success_fee"===e.type})).reduce((function(e,t){var n=t.amount;return e.plus(n)}),new(A())(0))}function _e(e,t,n){if("closed"===e.deal_status)return ve(t);var r=le(t),i=new(A())(e.price_last).minus(r).times(e.quantity),a=t.filter((function(e){return"sell"===e.type})).reduce((function(e,t){var n=t.price,i=t.quantity;return e.plus(new(A())(i).times(new(A())(n).minus(r)))}),new(A())(0)),o=n&&se(n),s=i.plus(a),u=s.gt(0)?s.times(ye(t)):new(A())(0);return o?u.times(new(A())(1).minus(o)):u}function ge(e){return e.filter((function(e){return"sell_fee"===e.type})).reduce((function(e,t){var n=t.amount;return e.plus(n)}),new(A())(0))}function we(e,t){return"ETF"===e.deal_type||"closed"===e.deal_status?ge(t):de(e,t).times(W)}function be(e,t,n){var r=me(e,t);if("ETF"===e.deal_type)return r;var i=_e(e,t,n),a=we(e,t);return r.minus(i.plus(a))}function xe(e,t){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null,r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null,i=t.reduce((function(e,t){var n=t.quantity,r=t.price;return e.plus(new(A())(r).times(n))}),new(A())(0)),a=t.reduce((function(e,t){var n=t.quantity;return e.plus(n)}),new(A())(0)),o=new Date(Math.max.apply(Math,I()(t.map((function(e){return e.timestamp}))))),s=i.minus(he(e,a,o)),u=n&&new Date(n),c=r&&new Date(r),l=u&&c?e.filter((function(e){var t=new Date(e.timestamp);return t>=u&&t<c})):e,f=ve(l),p=ge(l);return s.minus(f.plus(p))}var Se=n(376),Ee=n.n(Se),Ce={MILLISECOND:0,SECOND:1,MINUTE:2,HOUR:3,DAY:4,MONTH:5},Te=["agreement_agent_requested","agreement_agent_signed"],Ie=["agreement_signed"].concat(Te),Oe=["agreement_requested"].concat(I()(Ie)),Ae=["verified"].concat(I()(Oe)),ke=["verification_requested"].concat(I()(Ae));function Pe(e){return[e.line_1,e.line_2,e.apartment,e.town,e.area,e.zip,e.country].filter((function(e){return Boolean(e)})).join(", ")}function De(e,t){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"";return e||t?"".concat(e||"").concat(e&&t?" ":"").concat(t||""):n}function qe(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:Ce.HOUR,t=new Date;return e>=Ce.SECOND&&t.setUTCMilliseconds(0),e>=Ce.MINUTE&&t.setUTCSeconds(0),e>=Ce.HOUR&&t.setUTCMinutes(0),e>=Ce.DAY&&t.setUTCHours(0),e>=Ce.MONTH&&t.setUTCDate(1),t}function Re(e,t){return new Promise((function(n,r){var i=setTimeout(n,e);"function"==typeof t&&t((function(){clearTimeout(i),r()}))}))}function Ne(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"count_total";if(e.length<1)return{items:[],countTotal:0};var n=Number(e[0][t]);return e.forEach((function(e){delete e.count_total})),{items:e,countTotal:n}}function Ue(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function je(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Object.keys(e).filter((function(e){return!n.includes(e)})).reduce((function(t,n){return t[n]=e[n],t}),{})}function Fe(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.filter((function(t){return Ue(e,t)})).reduce((function(t,n){return t[n]=e[n],t}),{})}function Me(e){return Te.includes(e)}function Le(e){return Ie.includes(e)}function He(e){return Oe.includes(e)}function Ge(e){return Ae.includes(e)}function Ye(e){return ke.includes(e)}function Be(e){return Object.keys(e).map((function(t){var n=e[t];return Array.isArray(n)?n.map((function(e){return"".concat(t,"=").concat(encodeURIComponent(e))})).join("&"):"".concat(t,"=").concat(encodeURIComponent(n))})).join("&")}function We(e,t){return[].concat.apply([],e.map((function(n,r){return r%t?[]:[e.slice(r,r+t)]})))}function ze(e){var t=e.isTestnet,n=e.rpm,r="https://".concat(t?"tchain":"chain",".").concat("api.btc.com","/v").concat(3),i=Math.floor(6e4/n*1.25),a=0,o=!1,s=Promise.resolve(),u=function(){var e=d()(p().mark((function t(e,n){var s,u,c,l;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s="".concat(r,"/").concat(e),n&&(u=Be(n),s+=u&&"?".concat(u)),!((c=a+(o?6e4:i)-Date.now())>0)){t.next=6;break}return t.next=6,Re(c);case 6:return o=!1,t.prev=7,t.next=10,Ee().get(s);case 10:return l=t.sent,t.abrupt("return",l.data);case 14:throw t.prev=14,t.t0=t["catch"](7),t.t0.response&&429===t.t0.response.status&&(o=!0),t.t0;case 18:return t.prev=18,a=Date.now(),t.finish(18);case 21:case"end":return t.stop()}}),t,null,[[7,14,18,21]])})));return function(t,n){return e.apply(this,arguments)}}(),c=function(){var e=d()(p().mark((function t(e,n){return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,s;case 3:t.next=7;break;case 5:t.prev=5,t.t0=t["catch"](0);case 7:return s=u(e,n),t.abrupt("return",s);case 9:case"end":return t.stop()}}),t,null,[[0,5]])})));return function(t,n){return e.apply(this,arguments)}}();return{getAddressTransactions:function(){var e=d()(p().mark((function t(e){var n,r,i,a,o,s,u,l,f=arguments;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=f.length>1&&f[1]!==undefined?f[1]:{},r=n.page,i=void 0===r?1:r,a=n.pagesize,o=void 0===a?50:a,s=n.verbose,u=void 0===s?1:s,t.next=4,c("address/".concat(e,"/tx"),{page:i,pagesize:o,verbose:u});case 4:return l=t.sent,t.abrupt("return",l.data&&l.data.list||[]);case 6:case"end":return t.stop()}}),t)})));return function(t){return e.apply(this,arguments)}}(),request:c}}var Xe=n(38),$e=n.n(Xe),Qe=new Set(["USD"]),Ve={USD:2,BTC:8},Ke={USD:"$",BTC:"₿"},Je={BTC:new(A())("100000000")},Ze=["USD","BTC"];function et(e,t){return Ke[t]+" "+e}function tt(e){var t=e.split("."),n=$e()(t,2),r=n[0],i=n[1];return"".concat(r.replace(/\B(?=(\d{3})+(?!\d))/g,","),".").concat(i)}function nt(e,t){return new(A())(e).div(Je[t])}function rt(e,t){return Number(new(A())(e).times(Je[t]).toFixed(0))}function it(e,t){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{},r=n.withSign,i=void 0!==r&&r,a=n.withSeparators,o=void 0===a?i:a,s=Ve[t],u=new(A())(e),c=u.toFixed(s);return o&&(c=tt(c)),i&&(c=et(c,t)),c}function at(e){return Qe.has(e.toUpperCase())}function ot(e){return!at(e)}function st(e,t){var n=new(A())(e),r=new(A())(t);return n.div(r).times(100)}function ut(e){return function(e){var t=new(A())(e).times(V);return t.lt(J)?new(A())(J):t.gt(K)?new(A())(K):t}(e).plus(Q)}function ct(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function lt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ct(Object(n),!0).forEach((function(t){w()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ct(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ft=null;function pt(e){return ht.apply(this,arguments)}function ht(){return(ht=d()(p().mark((function e(t){var n,r,i,a,o,s,u,c,l,f,h,d,m,y,v,_,g;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.type,r=t.userWalletId,i=t.assetTicker,a=t.price,o=t.quantity,s=t.balance,u=t.nominal,c=void 0===u?null:u,l=t.tx,f=void 0===l?ft:l,e.next=3,f("user_wallets").where({id:r}).first("user_id","currency");case 3:return h=e.sent,c||(c=h.currency),e.next=7,f("user_operations").insert({type:n,balance:it(s,c),user_id:h.user_id,user_wallet_id:r}).returning("*");case 7:return d=e.sent,m=$e()(d,1),y=m[0],e.next=12,f("user_operations_asset").insert({quantity:o,user_operation_id:y.id,asset_ticker:i,price:it(a,c)}).returning("*");case 12:return v=e.sent,_=$e()(v,1),g=_[0],e.abrupt("return",je(lt(lt(lt({},y),g),{},{currency:h.currency}),"internal_id"));case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function dt(e){return mt.apply(this,arguments)}function mt(){return(mt=d()(p().mark((function e(t){var n,r,i,a,o,s,u,c,l,f,h,d,m,y,v,_,g,w,b;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.type,r=t.userWalletId,i=t.amount,a=t.assetTicker,o=t.transactionId,s=t.balance,u=t.referralId,c=t.comment,l=t.tx,f=void 0===l?ft:l,e.next=3,f("user_wallets").where({id:r}).first("user_id","currency");case 3:return h=e.sent,d={type:n,balance:it(s,h.currency),user_id:h.user_id,user_wallet_id:r},u&&(d.referral_id=u),c&&(d.comment=c),e.next=9,f("user_operations").insert(d).returning("*");case 9:return m=e.sent,y=$e()(m,1),v=y[0],_={user_operation_id:v.id,amount:it(i,h.currency)},a&&(_.asset_ticker=a),o&&(_.user_wallet_transaction_id=o),e.next=17,f("user_operations_wallet").insert(_).returning("*");case 17:return g=e.sent,w=$e()(g,1),b=w[0],e.abrupt("return",je(lt(lt(lt({},v),b),{},{currency:h.currency}),"internal_id"));case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function yt(e){ft=e}function vt(e){yt(e)}function _t(e){return gt.apply(this,arguments)}function gt(){return(gt=d()(p().mark((function e(t){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){t.close(e)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}const wt=function(){function e(){var t=this,n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};y()(this,e),w()(this,"_handleTermination",(function(){Promise.all([t._terminateHttpServerInstances(),t._terminateWsServerInstances()]).then((function(){return Promise.all([t._terminateAmqpInstances(),t._terminateFirebaseAdminAppInstances(),t._terminateFirestoreInstances(),t._terminateKnexInstances(),t._terminateRedisInstances()])})).then((function(){process.exit(0)})),setTimeout((function(){process.exit(1)}),t._forcedTerminationTimeout)}));var r=n.forcedTerminationTimeout,i=void 0===r?14e3:r,a=n.gracefulTerminationTimeout,o=void 0===a?1e4:a,s=n.terminationSignals,u=void 0===s?["SIGTERM","SIGINT"]:s;this._forcedTerminationTimeout=i,this._gracefulTerminationTimeout=o,this._amqpInstances=new Set,this._firebaseAdminAppInstances=new Set,this._firestoreInstances=new Set,this._httpServerInstances=new Map,this._knexInstances=new Set,this._redisInstances=new Set,this._wsServerInstances=new Set,u.forEach((function(e){process.on(e,t._handleTermination)}))}var t,r,i,a,o,s,u;return _()(e,[{key:"attachAmqpInstance",value:function(e){this._amqpInstances.add(e)}},{key:"attachFirebaseAdminAppInstance",value:function(e){this._firebaseAdminAppInstances.add(e)}},{key:"attachFirestoreInstance",value:function(e){this._firestoreInstances.add(e)}},{key:"attachHttpServer",value:function(e){var t=n(66).createHttpTerminator;this._httpServerInstances.set(e,t({server:e,gracefulTerminationTimeout:this._gracefulTerminationTimeout}))}},{key:"attachKnexInstance",value:function(e){this._knexInstances.add(e)}},{key:"attachRedisInstance",value:function(e){this._redisInstances.add(e)}},{key:"attachWsServer",value:function(e){this._wsServerInstances.add(e)}},{key:"_terminateAmqpInstances",value:(u=d()(p().mark((function c(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.allSettled(Array.from(this._amqpInstances).map((function(e){return e.close()}))));case 1:case"end":return e.stop()}}),c,this)}))),function(){return u.apply(this,arguments)})},{key:"_terminateFirebaseAdminAppInstances",value:(s=d()(p().mark((function l(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.allSettled(Array.from(this._firebaseAdminAppInstances).map((function(e){return e["delete"]()}))));case 1:case"end":return e.stop()}}),l,this)}))),function(){return s.apply(this,arguments)})},{key:"_terminateFirestoreInstances",value:(o=d()(p().mark((function f(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.allSettled(Array.from(this._firestoreInstances).map((function(e){return e.terminate()}))));case 1:case"end":return e.stop()}}),f,this)}))),function(){return o.apply(this,arguments)})},{key:"_terminateHttpServerInstances",value:(a=d()(p().mark((function h(){var e;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=Array.from(this._httpServerInstances.values()),t.abrupt("return",Promise.allSettled(e.map((function(e){return e.terminate()}))));case 2:case"end":return t.stop()}}),h,this)}))),function(){return a.apply(this,arguments)})},{key:"_terminateKnexInstances",value:(i=d()(p().mark((function m(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.allSettled(Array.from(this._knexInstances).map((function(e){return e.destroy()}))));case 1:case"end":return e.stop()}}),m,this)}))),function(){return i.apply(this,arguments)})},{key:"_terminateRedisInstances",value:(r=d()(p().mark((function v(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.allSettled(Array.from(this._redisInstances).map((function(e){return e.quit()}))));case 1:case"end":return e.stop()}}),v,this)}))),function(){return r.apply(this,arguments)})},{key:"_terminateWsServerInstances",value:(t=d()(p().mark((function g(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(Array.from(this._wsServerInstances).map(_t)));case 1:case"end":return e.stop()}}),g,this)}))),function(){return t.apply(this,arguments)})}]),e}()},666:e=>{var t=function(e){"use strict";var t,n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(P){u=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var i=t&&t.prototype instanceof y?t:y,a=Object.create(i.prototype),o=new O(r||[]);return a._invoke=function(e,t,n){var r=f;return function(i,a){if(r===h)throw new Error("Generator is already running");if(r===d){if("throw"===i)throw a;return k()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=C(o,n);if(s){if(s===m)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===f)throw r=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=h;var u=l(e,t,n);if("normal"===u.type){if(r=n.done?d:p,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=d,n.method="throw",n.arg=u.arg)}}}(e,n,o),a}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(P){return{type:"throw",arg:P}}}e.wrap=c;var f="suspendedStart",p="suspendedYield",h="executing",d="completed",m={};function y(){}function v(){}function _(){}var g={};g[a]=function(){return this};var w=Object.getPrototypeOf,b=w&&w(w(A([])));b&&b!==n&&r.call(b,a)&&(g=b);var x=_.prototype=y.prototype=Object.create(g);function S(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){function n(i,a,o,s){var u=l(e[i],e,a);if("throw"!==u.type){var c=u.arg,f=c.value;return f&&"object"==typeof f&&r.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(f).then((function(e){c.value=e,o(c)}),(function(e){return n("throw",e,o,s)}))}s(u.arg)}var i;this._invoke=function(e,r){function a(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(a,a):a()}}function C(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator["return"]&&(n.method="return",n.arg=t,C(e,n),"throw"===n.method))return m;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var i=l(r,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,m;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,m):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function A(e){if(e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}return{next:k}}function k(){return{value:t,done:!0}}return v.prototype=x.constructor=_,_.constructor=v,v.displayName=u(_,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,u(e,s,"GeneratorFunction")),e.prototype=Object.create(x),e},e.awrap=function(e){return{__await:e}},S(E.prototype),E.prototype[o]=function(){return this},e.AsyncIterator=E,e.async=function(t,n,r,i,a){void 0===a&&(a=Promise);var o=new E(c(t,n,r,i),a);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},S(x),u(x,s,"Generator"),x[a]=function(){return this},x.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=A,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(u&&c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,m):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),I(n),m}},"catch":function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;I(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:A(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),m}},e}(e.exports);try{regeneratorRuntime=t}catch(n){Function("r","regeneratorRuntime = r")(t)}},310:t=>{"use strict";t.exports=e},376:e=>{"use strict";e.exports=i},297:e=>{"use strict";e.exports=n},815:e=>{"use strict";e.exports=r},66:e=>{"use strict";e.exports=a},914:e=>{"use strict";e.exports=t}},s={};function u(e){if(s[e])return s[e].exports;var t=s[e]={exports:{}};return o[e](t,t.exports,u),t.exports}return u.n=e=>{var t=e&&e.__esModule?()=>e["default"]:()=>e;return u.d(t,{a:t}),t},u.d=(e,t)=>{for(var n in t)u.o(t,n)&&!u.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u(693)})()}));
//# sourceMappingURL=index.node.js.map